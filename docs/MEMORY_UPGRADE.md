# å¢å¼ºè®°å¿†ç³»ç»Ÿå‡çº§æ–‡æ¡£

## ğŸ¯ å‡çº§æ¦‚è¿°

å·²å®Œæˆ **Phase 1: è‡ªåŠ¨æå– + ç”¨æˆ·ç”»åƒ** çš„å®ç°ã€‚

## âœ¨ æ–°åŠŸèƒ½

### 1. **ç”¨æˆ·ç”»åƒç³»ç»Ÿ** (`UserProfile`)
è‡ªåŠ¨å»ºç«‹å’Œç»´æŠ¤ç”¨æˆ·ç‰¹å¾æ¨¡å‹ï¼š

**åŒ…å«ç»´åº¦ï¼š**
- ğŸ—£ï¸ **æ²Ÿé€šé£æ ¼**
  - è¯¦ç»†ç¨‹åº¦åå¥½ï¼ˆç®€æ´/é€‚ä¸­/è¯¦ç»†ï¼‰
  - è¯­è¨€åå¥½
  - æ­£å¼ç¨‹åº¦ï¼ˆæ­£å¼/éšæ„/æ··åˆï¼‰
  - Emojiä½¿ç”¨åå¥½
  - ä»£ç é£æ ¼ï¼ˆç®€æ´/è¯¦ç»†/å¸¦è§£é‡Šï¼‰

- ğŸ’» **æŠ€æœ¯èƒŒæ™¯**
  - ç¼–ç¨‹è¯­è¨€åˆ—è¡¨
  - ç»éªŒæ°´å¹³ï¼ˆåˆå­¦è€…/ä¸­çº§/é«˜çº§ï¼‰
  - æŠ€æœ¯é¢†åŸŸ
  - å¸¸ç”¨å·¥å…·

- ğŸ“Š **å·¥ä½œæ¨¡å¼**
  - é«˜é¢‘è¯é¢˜ç»Ÿè®¡
  - å…¸å‹ä»»åŠ¡ç±»å‹
  - æ´»è·ƒæ—¶é—´

- â¤ï¸ **ä¸ªäººåå¥½**
  - æ˜ç¡®å–œæ¬¢çš„å†…å®¹
  - æ˜ç¡®ä¸å–œæ¬¢çš„å†…å®¹
  - è§‚å¯Ÿåˆ°çš„ä½¿ç”¨ä¹ æƒ¯

**å­˜å‚¨ä½ç½®ï¼š** `config/user_profile.json`

### 2. **è‡ªåŠ¨è®°å¿†æå–**
ä»å¯¹è¯ä¸­è‡ªåŠ¨å­¦ä¹ ï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ ï¼š

**æå–å†…å®¹ï¼š**
- ç¼–ç¨‹è¯­è¨€å’Œå·¥å…·ä½¿ç”¨
- æŠ€æœ¯é¢†åŸŸå’Œé¡¹ç›®ä¿¡æ¯
- æ˜ç¡®è¡¨è¾¾çš„åå¥½å’ŒåŒæ¶
- æ²Ÿé€šé£æ ¼åå¥½

**è§¦å‘æ¡ä»¶ï¼ˆæ™ºèƒ½åˆ¤æ–­ï¼‰ï¼š**
- åŒ…å«åå¥½ä¿¡å·è¯ï¼ˆå–œæ¬¢ã€ä¸å–œæ¬¢ã€å€¾å‘ç­‰ï¼‰
- åŒ…å«æŠ€æœ¯å†…å®¹
- è¾ƒé•¿çš„å¯¹è¯ï¼ˆå¯èƒ½åŒ…å«æœ‰ä»·å€¼ä¿¡æ¯ï¼‰
- æ’é™¤ç®€å•é—®å€™è¯­

### 3. **å¢å¼ºçš„è®°å¿†æ£€ç´¢**
æ”¹è¿›çš„æœç´¢ç®—æ³•ï¼š
- åˆ†ç±»åŠ æƒï¼ˆuser_preferenceæƒé‡æœ€é«˜ï¼‰
- å®Œå…¨åŒ¹é…ä¼˜å…ˆ
- å…³é”®è¯åŒ¹é…
- ä½¿ç”¨è®¡æ•°è¿½è¸ªï¼ˆè¡¡é‡è®°å¿†é‡è¦æ€§ï¼‰

### 4. **ä¸Šä¸‹æ–‡å¢å¼º**
è‡ªåŠ¨å°†ç”¨æˆ·ç”»åƒå’Œç›¸å…³è®°å¿†æ³¨å…¥LLMä¸Šä¸‹æ–‡ï¼š

```python
[ç”¨æˆ·ç”»åƒ]
â€¢ å›å¤é£æ ¼ï¼šmoderateè¯¦ç»†åº¦ï¼Œcasualè¯­æ°”
â€¢ ç¼–ç¨‹è¯­è¨€ï¼šPython, JavaScript
â€¢ ç»éªŒæ°´å¹³ï¼šintermediate
â€¢ å–œæ¬¢ï¼šç®€æ´çš„ä»£ç 
â€¢ ä¸å–œæ¬¢ï¼šå†—é•¿çš„è§£é‡Š
â€¢ å¸¸è§è¯é¢˜ï¼šWebå¼€å‘, AI

[ç›¸å…³è®°å¿†]
â€¢ ç”¨æˆ·å–œæ¬¢ç®€æ´çš„ä»£ç ï¼Œä¸è¦å¤ªå¤šæ³¨é‡Š
â€¢ é¡¹ç›®åç§°ï¼šKoto AIåŠ©æ‰‹
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
web/
â”œâ”€â”€ enhanced_memory_manager.py    # å¢å¼ºè®°å¿†ç®¡ç†å™¨
â”œâ”€â”€ memory_integration.py          # é›†æˆæ¨¡å—
â”œâ”€â”€ memory_api_routes.py           # APIç«¯ç‚¹
â””â”€â”€ app.py                         # ä¸»åº”ç”¨ï¼ˆå·²ä¿®æ”¹ï¼‰

config/
â”œâ”€â”€ memory.json                    # è®°å¿†å­˜å‚¨
â””â”€â”€ user_profile.json              # ç”¨æˆ·ç”»åƒï¼ˆæ–°ï¼‰
```

## ğŸ”Œ APIç«¯ç‚¹

### è·å–ç”¨æˆ·ç”»åƒ
```http
GET /api/memory/profile
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "profile": {
    "communication_style": { ... },
    "technical_background": { ... },
    "preferences": { ... }
  },
  "summary": "intermediateçº§åˆ«å¼€å‘è€…ï¼Œç†Ÿæ‚‰Python/JavaScript"
}
```

### æ›´æ–°ç”¨æˆ·ç”»åƒ
```http
POST /api/memory/profile
Content-Type: application/json

{
  "communication_style": {
    "preferred_detail_level": "brief"
  }
}
```

### è§¦å‘è‡ªåŠ¨å­¦ä¹ ï¼ˆæµ‹è¯•ç”¨ï¼‰
```http
POST /api/memory/auto-learn
Content-Type: application/json

{
  "user_message": "æˆ‘å–œæ¬¢ç®€æ´çš„Pythonä»£ç ",
  "ai_message": "å¥½çš„ï¼Œæˆ‘ä¼šä¸ºä½ ç”Ÿæˆç®€æ´çš„ä»£ç "
}
```

### è·å–è®°å¿†ç»Ÿè®¡
```http
GET /api/memory/stats
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "stats": {
    "total_memories": 15,
    "by_category": {
      "user_preference": 8,
      "project_info": 5,
      "fact": 2
    },
    "by_source": {
      "user": 10,
      "extraction": 5
    },
    "most_used": [...],
    "profile_stats": {
      "total_interactions": 42,
      "programming_languages": 3,
      "tools": 5,
      "preferences_count": 6
    }
  }
}
```

## ğŸ§ª æµ‹è¯•

è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š
```bash
python web/enhanced_memory_manager.py
python web/memory_integration.py
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. è‡ªåŠ¨å­¦ä¹ ï¼ˆå·²é›†æˆï¼Œè‡ªåŠ¨è¿è¡Œï¼‰
ç³»ç»Ÿä¼šåœ¨å¯¹è¯è¿‡ç¨‹ä¸­è‡ªåŠ¨å­¦ä¹ ç”¨æˆ·ç‰¹å¾ã€‚

### 2. æ‰‹åŠ¨æ·»åŠ è®°å¿†
```python
memory_mgr = get_memory_manager()
memory_mgr.add_memory(
    "ç”¨æˆ·å–œæ¬¢ç®€æ´çš„ä»£ç ",
    category="user_preference"
)
```

### 3. æŸ¥çœ‹ç”¨æˆ·ç”»åƒ
åœ¨Kotoç•Œé¢ä¸­ï¼ˆæœªæ¥å¯æ·»åŠ UIç•Œé¢ï¼‰ï¼š
- è®¿é—® `/api/memory/profile` æŸ¥çœ‹å®Œæ•´ç”»åƒ
- è®¿é—® `/api/memory/stats` æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯

### 4. ä½“éªŒä¸ªæ€§åŒ–å›å¤
ç³»ç»Ÿä¼šæ ¹æ®ä½ çš„ç”»åƒè‡ªåŠ¨è°ƒæ•´ï¼š
- å›å¤çš„è¯¦ç»†ç¨‹åº¦
- ä»£ç é£æ ¼
- æŠ€æœ¯æœ¯è¯­çš„è§£é‡Šæ·±åº¦
- æ²Ÿé€šè¯­æ°”

## ğŸ“‹ ä¸‹ä¸€æ­¥è®¡åˆ’ï¼ˆPhase 2ï¼‰

### ğŸ”® å‘é‡æ£€ç´¢ç³»ç»Ÿ
- é›†æˆ FAISS æˆ– ChromaDB
- è¯­ä¹‰ç›¸ä¼¼åº¦åŒ¹é…
- æ›´å‡†ç¡®çš„è®°å¿†æ£€ç´¢

### ğŸ¨ å›å¤é£æ ¼è°ƒæ•´å™¨
- æ ¹æ®ç”¨æˆ·ç”»åƒè‡ªåŠ¨è°ƒæ•´å›å¤
- åŠ¨æ€è¯¦ç»†ç¨‹åº¦æ§åˆ¶
- ä¸ªæ€§åŒ–ä»£ç é£æ ¼

### ğŸ”„ ä¸»åŠ¨å­¦ä¹ 
- å‘¨æœŸæ€§åˆ†æå¯¹è¯å†å²
- ä¸»åŠ¨è¯¢é—®ç¡®è®¤åå¥½
- æŒç»­ä¼˜åŒ–ç”»åƒå‡†ç¡®æ€§

## âš™ï¸ é…ç½®

åœ¨ `config/user_profile.json` ä¸­å¯ä»¥æ‰‹åŠ¨è°ƒæ•´ç”»åƒï¼š

```json
{
  "communication_style": {
    "preferred_detail_level": "brief",  // brief/moderate/detailed
    "formality": "casual",              // formal/casual/mixed
    "emoji_usage": true,
    "code_style": "concise"             // concise/detailed/explained
  },
  "technical_background": {
    "experience_level": "intermediate"   // beginner/intermediate/advanced
  }
}
```

## ğŸ› æ•…éšœæ’é™¤

### å¢å¼ºè®°å¿†ç³»ç»ŸæœªåŠ è½½
æ£€æŸ¥æ—¥å¿—è¾“å‡ºï¼š
```
[INIT] âœ… å¢å¼ºè®°å¿†ç®¡ç†å™¨å·²åˆå§‹åŒ–   # æˆåŠŸ
[INIT] âš ï¸  ä½¿ç”¨åŸºç¡€è®°å¿†ç®¡ç†å™¨      # é™çº§åˆ°åŸºç¡€ç‰ˆ
```

å¦‚æœé™çº§ï¼Œæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š
- `web/enhanced_memory_manager.py`
- `web/memory_integration.py`
- `web/memory_api_routes.py`

### APIç«¯ç‚¹404
ç¡®ä¿ `memory_api_routes.py` è¢«æ­£ç¡®å¯¼å…¥ï¼š
```
ğŸ§  å¢å¼ºè®°å¿†ç³»ç»ŸAPIå·²åŠ è½½      # æˆåŠŸ
âš ï¸  å¢å¼ºè®°å¿†ç³»ç»ŸAPIæœªæ‰¾åˆ°     # å¤±è´¥
```

## ğŸ“š ä»£ç ç¤ºä¾‹

### åœ¨å¯¹è¯ä¸­ä½¿ç”¨
```python
# åœ¨ app.py çš„ chat_stream å‡½æ•°ä¸­
memory_mgr = get_memory_manager()

# è·å–å¢å¼ºçš„ä¸Šä¸‹æ–‡
memory_context = memory_mgr.get_context_string(user_input)
use_instruction += f"\n\n{memory_context}"

# å¯¹è¯ç»“æŸåï¼Œè‡ªåŠ¨å­¦ä¹ 
if hasattr(memory_mgr, 'auto_extract_from_conversation'):
    memory_mgr.auto_extract_from_conversation(
        user_input, 
        ai_response
    )
```

---

**å‡çº§å®Œæˆæ—¶é—´:** 2026-02-13  
**ç‰ˆæœ¬:** Enhanced Memory v1.0 (Phase 1)  
**ä¸‹ä¸€ç‰ˆæœ¬é¢„è®¡:** Phase 2 - è¯­ä¹‰æ£€ç´¢ ğŸ”®
