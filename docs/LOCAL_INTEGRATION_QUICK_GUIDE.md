# 🚀 Koto 本地集成 - 快速参考

## 📋 现在 Koto 知道什么

当用户问 Koto 任何问题时，Koto 的系统指令中现在包含了：

```
✅ 系统时间（精确到秒）
✅ CPU 使用率和核心数
✅ 内存使用情况（已用/总容量）
✅ 磁盘空间（所有分区）
✅ 网络状态和 IP 地址
✅ 运行中的关键进程
✅ Python 环境和已安装包数
✅ 任何系统警告
```

---

## 💡 Koto 现在能做什么

### 1️⃣ 环境感知建议
```
用户: "我想处理一个 10GB 的数据集"
Koto: "可以的。你有 32.4GB 内存可用，D 盘有 884GB 空间。
      完全够用。"
```

### 2️⃣ 性能诊断
```
用户: "电脑很卡"
Koto: "检查系统状态：
  - CPU 只有 17.8% 使用率
  - 内存 49.2% (充足)
  - 主要是 Client-Win64-Shipping.exe 在占用内存
  建议关闭这个应用。"
```

### 3️⃣ 资源规划
```
用户: "能同时运行多少个 Python 进程？"
Koto: "你有 24 个物理核心和 32.4GB 内存可用。
      可以轻松运行 10-20 个并行进程。"
```

### 4️⃣ 存储建议
```
用户: "生成的文件放哪里？"
Koto: "C 盘: 437GB 可用 (54.2% 满)
      D 盘: 884GB 可用 (53.6% 满)
      建议用 D 盘，空间更充足。"
```

---

## 🔧 技术信息

### 新建的文件
- [`web/system_info.py`](web/system_info.py) - 系统信息收集器 (470+ 行)

### 修改的文件
- `web/app.py` - `_get_chat_system_instruction()` 函数

### 核心类
```python
from web.system_info import SystemInfoCollector

collector = SystemInfoCollector()
info = collector.get_system_state()  # 获取所有信息
```

### 便利函数
```python
from web.system_info import (
    get_system_info,           # 获取完整系统信息
    get_formatted_system_info, # 获取格式化信息
    get_system_warnings        # 获取系统警告
)
```

---

## 📊 系统信息示例

每次生成系统指令时，Koto 都会包含这样的信息：

```
📊 CPU 状态:
  • 使用率: 17.8%
  • 核心: 24 物理 / 32 逻辑
  
🧠 内存状态:
  • 使用: 31.4GB / 63.79GB (49.2%)
  • 可用: 32.4GB

💿 磁盘状态:
  • C:: 515.95GB / 952.64GB (54.2%)
  • D:: 1023.29GB / 1907.71GB (53.6%)
  • 总剩余: 1321.11GB

🌐 网络状态:
  • 主机名: GroundControl
  • IP: 192.168.124.38

🐍 Python:
  • 版本: 3.11.9
  • 已安装包: 180 个
```

---

## ⚡ 性能

### 开销很小
- 首次加载: +30ms (可接受)
- 之后: 缓存命中，基本零开销
- 缓存超时: CPU/内存 2秒, 磁盘 10秒

### 不会阻塞
- 后台运行，不影响 UI
- 系统调用被最小化
- 智能缓存避免重复查询

---

## 🎯 改进方向

### 第二阶段：智能上下文注入
- 根据问题类型，智能选择 include 哪些系统信息
- 性能优化（不总是包含所有信息）

### 第三阶段：工具集成
- Koto 可以在需要时实时查询系统信息
- 自动化脚本生成基于当前系统

### 第四阶段：高级功能
- 性能监控和优化建议
- 系统事件响应
- 自动化操作建议

---

## ✨ 最重要的变化

### 修复前 ❌
```
Koto: "我建议你使用并行处理"
（但不知道你有 24 个核心）

Koto: "你可以保存这个文件"
（但不知道你的磁盘只剩 100GB）

Koto: "这个应用会很快"
（但你的内存已经快满了）
```

### 现在 ✅
```
Koto: "你有 24 个核心，完全适合并行处理。"

Koto: "你的 D 盘有 884GB 可用，足够保存。"

Koto: "注意你的内存只剩 32.4GB，这个应用
       可以运行但要监控内存使用。"
```

---

## 📈 用户体验提升

| 场景 | 前 | 后 |
|------|-----|------|
| 问文件存储 | 通用回答 | 基于实际磁盘 |
| 问代码性能 | 理论建议 | 基于实际 CPU/内存 |
| 问系统问题 | 无法诊断 | 分析当前系统 |
| 问是否能做 | 不确定 | 基于实际资源 |

---

## 🚀 启动 Koto

现在当你启动 Koto 时：

```bash
python koto_app.py
```

Koto 会自动：
1. ✅ 收集系统信息
2. ✅ 生成包含系统状态的系统指令
3. ✅ 基于实际环境做出建议
4. ✅ 与用户保持"同频"

---

## 💬 示例对话

### 对话 1
```
用户: "电脑配置怎么样？"
Koto: "你的配置很不错：
  - CPU: 24 物理核心（高性能）
  - 内存: 63.79GB (充足)
  - 磁盘: 总 2.8TB, 剩余 1.3TB
  - 当前使用率都很健康
  
这个配置适合深度学习、大数据处理等复杂任务。"
```

### 对话 2
```
用户: "我想同时运行 5 个 Python 脚本"
Koto: "没问题。检查你的系统：
  - CPU 使用率: 17.8% (余量很大)
  - 内存: 62% 使用率 (还有 3GB 虚拟内存)
  
5 个脚本很轻松。如果脚本是 CPU 密集的，
可以充分利用你的 24 核。"
```

### 对话 3
```
用户: "电脑变慢了怎么办？"
Koto: "根据当前系统状态分析：
  - CPU: 17.8% (正常)
  - 内存: 49.2% (正常)  
  - 主要耗内存: Client-Win64-Shipping.exe (9.77%)
  
不是硬件瓶颈。建议：
  1. 关闭不必要的后台应用
  2. 特别是 Client-Win64-Shipping.exe
  3. 检查磁盘碎片（虽然当前空间充足）"
```

---

## ✅ 验证本地集成是否工作

```bash
# 测试系统信息收集
python -c "from web.system_info import get_formatted_system_info; print(get_formatted_system_info())"

# 测试系统指令生成
python -c "from web.app import _get_chat_system_instruction; print(_get_chat_system_instruction()[:500])"
```

---

**Koto 现在真正成为了你计算机的个人 AI 助手！** 🎉

与其说 Koto 是一个通用 AI，不如说它是与你的电脑深度融合的智能系统。

它了解你的配置，理解你的环境约束，能够给出符合实际情况的建议。

**这就是"同频"的真正含义。** 🎯
